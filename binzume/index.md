Title: オフトゥンでスヤァしながら加速度体験ができる秘密のデバイス
Subtitle: 電子工作＋バーチャル・リアリティ(仮)
Author: @binzume
Author(romaji): binzume

# オフトゥンでスヤァしながら加速度体験ができる秘密のデバイス

　こんにちは，binzumeです．記事のタイトルはいつのまにか決められていました．今回は頭に電流を流して，バーチャルな加速度を感じて遊ぶ話を書きます．前庭電気刺激(GVS)とよばれる技術を用いて仮想空間上で擬似的な加速度を体感するための電子工作や簡単なアプリを開発するという内容です．

最近，会社で電子工作同好会という同好会を作ったので，久しぶりに何か作るかと思い立ちました．ネタ自体はしばらく温め続けていたものですが，やっと行動に移しました．今回こそは何かためになる真面目な記事を書こうと思っていたのですが，ネタに走ってしまいました．

※ この記事を読んだ結果生じたいかなる損害に対しても責任は負えません．特に電気の事故は生命に関わる場合もあるため，よく理解した上で遊びましょう．十分気をつけて自分の責任で行って下さい．

## 仮想世界と加速度

Oculus Riftで遊んでいると気持ち悪くなることがあると思いますが，原因の一つとして視覚として入力される風景の動きと身体が感じる感覚が一致しないことがあります．特にVR空間内で移動して視点が変わるが，実際の身体が動いてないという場合はどうしても違和感があります．
解決する方法の一つとして，実際に身体を動かしてそれをポジショントラッキングで認識したり，外部から加速度や振動などを与える設備を用意することがあげられると思います．

前者はOclus Rift DK2がカメラによるポジショントラッキングをサポートしています．後者も簡単ではありませんが多くの方が試みています．

実際に身体を動かす系．

超会議2015の展示とか．

楽しそう．

筆者も，スマートフォンのセンサを使ったポジショントラッキングを試みて，部屋の中を歩きまわったりしていました．

http://qiita.com/binzume/items/3bbca6ab8a7926fc7255


これはこれで楽しいのですが，ただ，何かが違うという思いがつきまといます．
必要なのは 仮想空間内での運動 と 感じる加速度が同期することであって，実際に身体を動かす必要は無いはずです．

ソードアート・オンライン第一話でナーヴギアをかぶったキリトくんが一人ベッドに横たわり「リンクスタート」する場面を思い返しましょう．

## 前庭電気刺激(GVS)

前庭電気刺激というと聞きなれない言葉かも知れませんが，古くから知られている現象です．

人間の内耳内には，加速度を知覚し平衡感覚を司る前庭という組織があります．角速度を感じる三半規管に接しています．

前庭に1～2mAの電流を流すと平衡感覚が狂い架空の加速度を感じます．電流の向きで加速度の方向はコントロールできることも知られています．

頭に電流を流して感覚を操作するというと高度な何かに聞こえますが，電流を流すことは簡単な回路で実現できるので作ってみることにします．

### ハードウェア

なるべく簡単に入手しやすいパーツで作ることにします．

DC-DC昇圧回路で昇圧し，MOSFETで電流を制御します．回路を単純にするため極性はリレーで制御しました．
リレーを使っているため極性の切り替えに数十msかかりますがほとんどの場合はこれで十分間に合います．

昇圧回路は市販のキットを使うことにします．
電極どうしようか悩んだのですが，色々調べてみて低周波治療器の電極を使うことにしました．


TODO: 回路図


```
                                                       5Vpp              9Vpp                           200V
+------+               +----------+          +-------+      +----------+      +--------+    +-----------+    +------------+    ************
|  PC  |  -(USB-SPI)-> | AVR      | -(SPI)-> |  DAC  | ---> | OPアンプ | ---> | MOSFET | -> | DC-DC昇圧 | -> | 電極パッド | -> * 前庭器官 *
|      |               | ATMEGA88 |          |       |      |          |      |        |    | 9V->200V  | -> |            |    *          *
+------+               +----------+          +-------+      +----------+      +--------+    +-----------+    +------------+    ************

```

- AVR ATMEGA88 (秋月)
- D/Aコンバータ MCP4922 (秋月)
- MOSFET 2SK3234 (秋月)
- OPアンプ LMC662CN TODO: 別のに置換予定
- DC-DC昇圧回路 (aitendo) http://www.aitendo.com/product/6872
- 電極パッド (amazon) http://www.amazon.co.jp/dp/B0002ERMBE


http://www.todesking.com/hitosinigaderu/
低周波治療器の電極使うのはここからパクりました．回路も参考にしています．


### 実験

計算上は大丈夫ですが念のため，万が一の時にも致命傷を負わない腕などの箇所で実験します．

2mA程度のパルスを入れるとちょっとだけピリピリする感じがあり，もっと電流を流すと腕の筋肉が勝手に収縮します．

電流のフィードバック制御が正しく動いていることも確認します．

正しく動いている場合は大丈夫そうです．が，色々試行錯誤している最中に間違って大きな電流を流してしまうことは十分予期できるので，
ハードウェア上の最大電流を流した場合どうなるかは確認そておきます．
電流の衝撃と驚きで腕が動き，配線に引っ張られて試作中だった回路が危うく飛んできそうでしたが，腕には感電での火傷などもなく大丈夫そうでした．

というわけで安全かどうかは置いておいて，大丈夫そうなので前庭を刺激します．

派手に感電した直後なので，まだ恐怖が残ってますが耳の後ろ辺りに電極を貼ります．
まだ電流を流してないのにドキドキするので電流恐怖症になったかと思いましたが10分もすると忘れました．

耳の後ろ辺りに電極パッドを貼り付けて電流を流すと加速度を感じます．

1.5～2mA程度が良さそうです．

適当な信号を入力すると，世界が傾いて感じたり，グラグラ揺れたり，面白いです．
ただし，どうしても気になることが一つ．

味がします．

いわゆる電気の味です．色々サボって，矩形波を出力していたのですが，注意深く矩形のエッジの波形を観察して見ると，
なんとなく予想はしていましたが電流が流れすぎています．どうやら口の中に電流が流れそれが味として感じられていたようです．

あと，目をつぶっていても，視界がチカチカ光ることにも気づきました．
健康に害がないことを祈ります．



## アプリ


TODO: Oculus Riftでどうにかする．簡単なアプリ．

TODO: 動画と一緒に加速度も記録するカメラアプリ．電極をつないだ状態で動画をOculus Riftで再生．

## 課題

- 昇圧回路は非絶縁なので複数同時に使えない．１軸のみ．
- 大雑把な感覚しか与えられない
- 三半規管もどうにかしたい．例えば電流流しつつ，強めの磁場を与えれば三半規管内のリンパ液を動かせないかとかとか．

最初の一つは解決は難しくない気がしますが，残りの２つはとくにアイデアはありません．

## まとめ

細かい制御は無理そうなので実用的では無いかもしれません．

- 舐めなくても電気の味がする
- あまり複雑なことできないが，可能性感じる
- SAOのナーヴギアは結構遠い

### 参考文献

大阪大 前田研究室
http://www-hiel.ist.osaka-u.ac.jp/japanese/exp/gvs.html

http://www.todesking.com/hitosinigaderu/



最初にも書きましたが，危険な遊びなので十分気をつけて，自分の責任で行って下さい．この記事を読んだ結果生じたいかなる損害に対しても責任は負えません．特に電気の事故は生命に関わる場合もあるため，よく理解した上で遊びましょう．

回路図や実験に使ったソースコードはGitHub上に置いておきます．

 https://github.com/binzume/gvs (予定)

